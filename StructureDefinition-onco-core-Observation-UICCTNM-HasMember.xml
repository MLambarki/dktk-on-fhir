<?xml version="1.0" encoding="utf-8"?>
<StructureDefinition xmlns="http://hl7.org/fhir">
  <url value="http://dktk.dkfz.de/fhir/StructureDefinition/onco-core-Observation-UICCTNM-HasMember" />
  <version value="0.1.0" />
  <name value="UICCTNMHasMember" />
  <status value="draft" />
  <fhirVersion value="4.0.0" />
  <kind value="resource" />
  <abstract value="false" />
  <type value="Observation" />
  <baseDefinition value="http://hl7.org/fhir/StructureDefinition/Observation" />
  <derivation value="constraint" />
  <differential>
    <element id="Observation.status">
      <path value="Observation.status" />
      <mustSupport value="true" />
    </element>
    <element id="Observation.category.coding.system">
      <path value="Observation.category.coding.system" />
      <min value="1" />
      <fixedUri value="http://hl7.org/fhir/observation-category" />
    </element>
    <element id="Observation.category.coding.code">
      <path value="Observation.category.coding.code" />
      <min value="1" />
      <fixedCode value="laboratory" />
    </element>
    <element id="Observation.code">
      <path value="Observation.code" />
      <mustSupport value="true" />
    </element>
    <element id="Observation.code.coding.system">
      <path value="Observation.code.coding.system" />
      <min value="1" />
      <fixedUri value="http://loinc.org" />
    </element>
    <element id="Observation.code.coding.code">
      <path value="Observation.code.coding.code" />
      <min value="1" />
      <fixedCode value="21914-7" />
    </element>
    <element id="Observation.subject">
      <path value="Observation.subject" />
      <min value="1" />
      <type>
        <code value="Reference" />
        <targetProfile value="http://dktk.dkfz.de/fhir/StructureDefinition/onco-core-Patient-Patient" />
        <targetProfile value="http://dktk.dkfz.de/fhir/StructureDefinition/onco-core-Patient-Pseudonym" />
      </type>
      <mustSupport value="true" />
    </element>
    <element id="Observation.encounter">
      <path value="Observation.encounter" />
      <type>
        <code value="Reference" />
        <targetProfile value="http://dktk.dkfz.de/fhir/StructureDefinition/onco-core-Encounter-Fall" />
      </type>
    </element>
    <element id="Observation.effective[x]">
      <path value="Observation.effective[x]" />
      <short value="Datum der TNM-Dokumentation/Datum Befund" />
      <definition value="Es handelt sich sinngemäß um das Datum, an welchem der Datensatz zum TNM angelegt wurde und welches auch als auswertungsrelevant anzusehen ist. Es ist i.d.R. mit dem Diagnosedatum identisch bzw. liegt nah zu diesem Datum." />
      <type>
        <code value="dateTime" />
      </type>
      <mapping>
        <identity value="ADT-GEKID" />
        <map value="TNM:TNM_Datum" />
        <comment value="TNM:TNM_Datum" />
      </mapping>
      <mapping>
        <identity value="ISO-11179" />
        <map value="urn:dktk:dataelement:2:3" />
        <comment value="urn:dktk:dataelement:2:3" />
      </mapping>
    </element>
    <element id="Observation.value[x]">
      <path value="Observation.value[x]" />
      <type>
        <code value="CodeableConcept" />
      </type>
      <mustSupport value="true" />
      <binding>
        <strength value="required" />
        <description value="Gibt das Stadium des Tumors (nach &quot;Union internationale contre le cancer&quot;) an" />
        <valueSet value="http://dktk.dkfz.de/fhir/onco/core/ValueSet/UiccstadiumVS" />
      </binding>
    </element>
    <element id="Observation.value[x].coding.version">
      <path value="Observation.value[x].coding.version" />
      <short value="TNM-Version" />
      <definition value="Katalogversion des TNM" />
      <min value="1" />
      <binding>
        <strength value="extensible" />
        <description value="Katalogversion des TNM" />
        <valueSet value="http://dktk.dkfz.de/fhir/onco/core/ValueSet/TNMVersionVS" />
      </binding>
      <mapping>
        <identity value="ADT-GEKID" />
        <map value="TNM:TNM_Version" />
        <comment value="TNM:TNM_Version" />
      </mapping>
      <mapping>
        <identity value="ISO-11179" />
        <map value="urn:dktk:dataelement:18:2" />
        <comment value="urn:dktk:dataelement:18:2" />
      </mapping>
    </element>
    <element id="Observation.value[x].coding.code">
      <path value="Observation.value[x].coding.code" />
      <short value="UICC Stadium" />
      <definition value="Gibt das Stadium des Tumors (nach &quot;Union internationale contre le cancer&quot;) an" />
      <min value="1" />
      <mapping>
        <identity value="ADT-GEKID" />
        <map value="TNM.TNM_T, TNM.TNM_N,  TNM.TNM_M" />
        <comment value="Berechnet aus 3 TNM Elementen" />
      </mapping>
      <mapping>
        <identity value="ISO-11179" />
        <map value="urn:dktk:dataelement:89:1" />
        <comment value="urn:dktk:dataelement:89:1" />
      </mapping>
    </element>
     <element id="Observation.method">
      <path value="Observation.method" />
      <mustSupport value="false" />
      <binding>
        <strength value="required" />
        <description value="klinisch/pathologisch" />
        <valueSet value="http://dktk.dkfz.de/fhir/onco/core/ValueSet/TNMcpuPraefixTVS" />
      </binding>
    </element>
    <element id="Observation.hasMember">
      <path value="Observation.hasMember" />
      <slicing>
        <discriminator>
          <type value="profile" />
          <path value="resolve()" />
        </discriminator>
        <ordered value="false"/>
        <rules value="open" />
      </slicing>
      <min value="0"/>
    <max value="*"/>
      <type>
        <code value="Reference"/>
        </type>
    </element>
    
    <element id="Observation.hasMember:pTNM">
      <path value="Observation.hasMember" />
      <sliceName value="pTNM" />
      <max value="1" />
      <type>
        <code value="Reference" />
        <targetProfile value="http://dktk.dkfz.de/fhir/StructureDefinition/onco-core-Observation-TNMp" />
      </type>
      <mustSupport value="true" />
    </element>
    
    <element id="Observation.hasMember:pTNM.reference">
      <path value="Observation.hasMember.reference" />
      <min value="1" />
    </element>

    <element id="Observation.hasMember:cTNM">
      <path value="Observation.hasMember" />
      <sliceName value="cTNM" />
      <max value="1" />
      <type>
        <code value="Reference" />
        <targetProfile value="http://dktk.dkfz.de/fhir/StructureDefinition/onco-core-Observation-TNMc" />
      </type>
      <mustSupport value="true" />
    </element>
    
    <element id="Observation.hasMember:cTNM.reference">
      <path value="Observation.hasMember.reference" />
      <min value="1" />
    </element>
    
  </differential>
</StructureDefinition>